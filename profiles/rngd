# AppArmor profile for rngd entropy generator daemon
# Version of rngd (rng-tools) profiled: 6.10
# Homepage: https://git.sr.ht/~krathalan/apparmor-profiles/
# Copyright 2019 (C) krathalan; Licensed under GPLv3

#include <tunables/global>

profile rngd /usr/bin/rngd {
  #include <abstractions/base>
  #include <abstractions/krathalans-hardening>

  # Kind of dangerous; sys_admin is a huge capability
  capability sys_admin,

  # System access
  owner /dev/ r,
  owner /dev/hwrng r,
  owner /dev/random rw,
  owner /sys/bus/ r,
  owner /sys/class/ r,
  owner @{PROC}/sys/kernel/random/* rw,

  # Config file
  owner /etc/conf.d/rngd r,

  # Deny unnecessary permissions
  deny /dev/bus/usb/ r,
  deny /sys/bus/usb/devices/ r,
}
