# AppArmor profile for syncthing synchronization program
# Version of syncthing profiled: 1.10.0
# Homepage: https://git.sr.ht/~krathalan/apparmor-profiles/
# Copyright 2019 (C) krathalan; Licensed under GPLv3

#include <tunables/global>

profile syncthing /usr/bin/syncthing {
  #include <abstractions/base>
  #include <abstractions/krathalans-hardening>

  /usr/bin/syncthing rPx,

  # Networking
  #include <abstractions/krathalans-networking>
  #include <abstractions/ssl_certs>
  #include <abstractions/ssl_keys>
  /etc/ca-certificates/extracted/cadir/* r,
  /etc/iproute2/rt_tables r,
  @{PROC}/sys/net/core/somaxconn r,
  @{PROC}/*/net/route r,
  /usr/bin/ip rix,

  # Include user overrides for synced directories
  #include <local/syncthing>

  # https://www.kernel.org/doc/Documentation/vm/transhuge.txt
  /sys/kernel/mm/transparent_hugepage/hpage_pmd_size r,

  # Config
  owner @{HOME}/.config/syncthing/ r,
  owner @{HOME}/.config/syncthing/** rwk,

  # Miscellaneous
  /etc/mime.types r,
}
