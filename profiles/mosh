# AppArmor profile for mosh mobile shell
# Only meant to be used on clients -- NOT SERVERS!
# Version of mosh profiled: 1.3.2
# Homepage: https://git.sr.ht/~krathalan/apparmor-profiles/
# Copyright 2019 (C) krathalan; Licensed under GPLv3

#include <tunables/global>

profile mosh /usr/bin/mosh* {
  #include <abstractions/base>
  #include <abstractions/krathalans-hardening>
  #include <abstractions/krathalans-networking>
  #include <abstractions/perl>

  # Binaries
  /usr/bin/env r,
  /usr/bin/mosh r,
  /usr/bin/mosh-client mrPx,

  # SSH
  /usr/bin/ssh Px,
  signal receive set=hup peer=/usr/bin/ssh,
  signal receive set=hup peer=ssh,

  # Networking
  /etc/nsswitch.conf r,
  /etc/{protocols,services} r,

  # Display properly on different host terminals
  @{system_share_dirs}/terminfo/** r,
}
