# AppArmor profile for gpg-agent
# Version of gpg-agent (gnupg) profiled: 2.2.17
# Homepage: https://gitlab.com/krathalan/apparmor-profiles
# Copyright 2019 (C) krathalan; Licensed under GPLv3

#include <tunables/global>

profile gpg-agent /usr/bin/gpg-agent {
  #include <abstractions/base>

  # Process info
  @{PROC}/@{pid}/** r,

  # Curses pinentry
  /usr/bin/pinentry-curses rix,
  /dev/pts/* rw,
  @{system_share_dirs}/terminfo/** r,

  # Include user overrides for possible symlinked config files
  #include <local/usr.bin.gpg-agent>

  # Access user keys
  owner @{HOME}/.gnupg/** rw,

  # Miscellaneous
  /usr/bin/dash rix,
  @{system_share_dirs}/gnupg/* r,

  # Silence unnecessary permissions
  deny /var/cache/** w,
}
